(executable
 ((name json)
  (modules (json))
  (libraries (rpclib rpclib.json threads))
))

(executable
 ((name xapi)
  (modules (xapi))
  (libraries (rpclib threads))
))

(alias
 ((name   runtest)
  (package rpclib)
  (deps (json.exe
         xapi.exe))
  (action (progn
    (run ./json.exe)
    (run ./xapi.exe)
    ))))


(executable
 ((name all_types)
  (modules (all_types))
  (libraries (rpclib rpclib.json threads))
  (preprocess (pps (ppx_deriving_rpc)))
))

(executable
 ((name client_async_new)
  (modules (client_async_new))
  (libraries (async rpclib rpclib-async rpclib.json threads))
  (preprocess (pps (ppx_deriving_rpc)))
))

(executable
 ((name client_lwt_new)
  (modules (client_lwt_new))
  (libraries (lwt.unix rpclib rpclib-lwt rpclib.json threads))
  (preprocess (pps (ppx_deriving_rpc)))
))

(executable
 ((name dict)
  (modules (dict))
  (libraries (rpclib threads))
  (preprocess (pps (ppx_deriving_rpc)))
))

(executable
 ((name encoding)
  (modules (encoding))
  (libraries (rpclib threads))
  (preprocess (pps (ppx_deriving_rpc)))
))

(executable
 ((name option)
  (modules (option))
  (libraries (rpclib threads))
  (preprocess (pps (ppx_deriving_rpc)))
))

(executable
 ((name phantom)
  (modules (phantom))
  (libraries (rpclib threads))
  (preprocess (pps (ppx_deriving_rpc)))
))

(executable
 ((name variants)
  (modules (variants))
  (libraries (rpclib threads))
  (preprocess (pps (ppx_deriving_rpc)))
))

(alias
 ((name   runtest)
  (package ppx_deriving_rpc)
  (deps (all_types.exe
         client_async_new.exe
         client_lwt_new.exe
         dict.exe
         encoding.exe
         option.exe
         phantom.exe
         variants.exe))
  (action (progn
    (run ./all_types.exe)
    (run ./client_async_new.exe)
    (run ./client_lwt_new.exe)
    (run ./dict.exe)
    (run ./encoding.exe)
    (run ./option.exe)
    (run ./phantom.exe)
    (run ./variants.exe)
    ))))

(executable
 ((name suite)
  (modules (suite client_server_test))
  (libraries (rpclib rpclib-async rpclib-lwt alcotest alcotest-lwt))
 ))

(alias
 ((name runtest)
  (package rpc)
  (deps (suite.exe))
  (action (run ${<}))
 ))

